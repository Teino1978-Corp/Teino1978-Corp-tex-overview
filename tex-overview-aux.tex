% !TeX root = tex-overview.tex

\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  urlcolor=blue,
  pdfborder=0 0 0
}
\let\bfseries\scshape
\ExplSyntaxNamesOn
%% some missing definitions for \TeX-like things
\tl_set:Nn\XeT{X\kern -.1667em\lower .5ex\hbox {E}\kern -.125emT\@}
\tl_set:Nn\ConTeXt{Con\TeX{}t}

%% constants for the colors. Might change from time to time …
\tl_set:Nn\vip{red}
\tl_set:Nn\other{black}
\tl_set:Nn\normalimportant{blue}
\tl_set:Nn\experimental{yellow}

\tl_set:Nn\program{black}
\tl_set:Nn\package{green}
\tl_set:Nn\distro{gray}

%% shorthand to keep a good structure of the node positions
\fp_new:N\layer
\fp_new:N\layerdist
\fp_set:Nn\layer{0}
\fp_set:Nn\layerdist{-1}

%% to separate important from not-so-important nodes
\bool_new:N\short
\bool_gset_true:N\short

%% width of the tooltip-boxes (negative value to make them disappear)
\dim_set:Nn\fboxrule{-1mm}

%% Style of the nodes
\tikzstyle{coolnode} = [
	draw=\nodecolor!50!black!70,
	top color=\nodecolor!10!white!105,
	bottom color= \nodecolor!50!black!50
]

%% tonode ⇒ tex-overview node, now with better argument specifier
\NewDocumentCommand\TOnode{O{\normalimportant}D(){no label given}D(){no position given}D<>{no description given}m}{
%% test if we are in the short or full view
  \gdef\nodecolor{#1}
  \bool_if:NTF\short{
  %% short view
    \tl_if_eq:NNT#1{\vip}{   %% then check if this is an important node
      \node[coolnode]
	(#2) at (#3) {
        \cooltooltip{#2}{#4}{#4}{}{#5\strut}
      };
    }
  }{
  %% long view
    \node[coolnode] (#2) at (#3) {
      \cooltooltip{#2}{#4}{#4}{}{#5\strut}
    };
  %% and the text view, to be added only once!
  \AtEndDocument{\subsubsection*{\color{blue}#5}\parbox{\textwidth}{#4}}
  }
}

% the old command.
\NewDocumentCommand\tonode{O{\normalimportant}mmmm}{
  \TOnode[#1](#2)(#3)<#4>{#5}
}

%% a command for creation of bib-items.
\NewDocumentCommand\tobibsection{m}{
  \section*{#1}
}
\NewDocumentCommand\tobib{mD<>{}O{}}{
  \vspace*{1.5ex}
\begin{minipage}{\textwidth}  %% to prevent page breaks
  #1\\ \quad \url{#2} #3
\end{minipage}
}

%% we want to make use of two pdf layers: the upper (main) one for the nodes
%% and the lower (background) one for the lines. That way, the lines will not cross the nodes
\pgfdeclarelayer{background}
\pgfsetlayers{background,main}

%% the command to draw from one node to the other one. Fine tuning is possible via optional argument #3
\NewDocumentCommand{\todraw}{st{'}O{}d()d()}{
  \begin{pgfonlayer}{background}
    %% draw in the case that: either a * is given (always draw) or (' is given and \short) or nothing is given
    \bool_if:nT{#1 || (#2 && \short) || !(#2 || \short)}
      {\draw [thick,gray,#3] (#4) to (#5);}  %% I’m just loooving expl3!
  \end{pgfonlayer}
}

\NewDocumentCommand{\setlayer}{m}{
  \fp_set:Nn\layer{#1}
}
\NewDocumentCommand{\steplayer}{O{\layerdist}}{
  \fp_add:Nn\layer{#1}
}

\NewDocumentCommand{\overviewsection}{m}{
  \clearpage
  \dim_set:Nn\pdfpagewidth{9cm}       %% make a smaller paper so the header won’t feel so alone on the big, big paper
  \dim_set:Nn\pdfpageheight{2.5cm}
  \section{#1\bool_if:NT\short{ – short view}}
  \clearpage
  \dim_set:Nn\pdfpagewidth{21cm}     %% back to a4
  \dim_set:Nn\pdfpageheight{29.7cm}
}
\NewDocumentCommand{\overviewsubsection}{om}{
\IfNoValueTF{#1}{\subsection{#2}}{\subsection[#1]{#2}}
  \bool_if:NF\short{\AtEndDocument{\IfNoValueTF{#1}{\subsection{#2}}{\subsection[#1]{#2}}}}
}

\ExplSyntaxNamesOff